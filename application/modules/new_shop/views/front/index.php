  
  <div id="content" class="mr horizontal-wrapper pemasaran" data-aos="fade">
    <div class="kantor-map map-box not-hscroll">
      <div class="map not-hscroll" id="map"></div>
    </div>

    <div class="map-filter row bg-light-green" id="tokoFilter">
      <div class="col-md-12 col-xs-9">
        <h3 class="font-sofia-bold font-md  font-green">Cari Toko</h3>
      </div>
      <div class="col-xs-3 desktop-hide text-right">
        <img src="/avian_new/images/search.png" id="search-trigger">
      </div>
      <div class="col-md-8 col-xs-12 search-hideshow">
        <div class="form-group">
          <select class="input-form">
            <option>Berdasarkan Lokasi</option>
            <option>Berdasarkan Nama Toko</option>
            <option>Berdasarkan Nama Produk</option>
          </select>
          <input type="text" class="input-form" placeholder="Lokasi Anda">
        </div>
      </div>
      <div class="col-md-2 col-xs-12 search-hideshow">
        <button class="button button-rounded button-block btn-inline-green font-green" type="submit">Cari</button>
      </div>
      <div class="col-md-2 col-xs-12 search-hideshow">
        <button class="button button-rounded button-block btn-inline-green font-green btn-mfilter" data-container="body" data-toggle="popover" data-placement="bottom" data-popover-content="#popoverContent">
          + Filter
        </button>

        <div style="display: none;">
          <div id="popoverContent">
            <div class="row">
              <div class="col-sm-6 col-xs-12">
                <ul class="fgroup">
                  <li class="title-group">
                    <div class="row rowcheck">
                      <div class="col-md-2 col-xs-2 padcheck">
                        <label class="content-check">
                          <input type="checkbox" name="cat_tembok_premium" >
                          <span class="checkmark"></span>
                        </label>
                      </div>
                      <div class="col-md-10 col-xs-9 textcheck"><h4 class="font-sofia-bold">Cat Tembok Premium</h4></div>
                    </div>
                  </li>
                  <li>
                    <div class="row rowcheck">
                      <div class="col-md-2 col-xs-2 padcheck">
                        <label class="content-check">
                          <input type="checkbox" name="sunguard_all_in_1">
                          <span class="checkmark"></span>
                        </label>
                      </div>
                      <div class="col-md-10 col-xs-9 textcheck"><p class="font-sofia-light font-sm font-green text">Sunguard All-In-One</p></div>
                    </div>
                  </li>
                  <li>
                    <div class="row rowcheck">
                      <div class="col-md-2 col-xs-2 padcheck">
                        <label class="content-check">
                          <input type="checkbox"  >
                          <span class="checkmark"></span>
                        </label>
                      </div>
                      <div class="col-md-10 col-xs-9 textcheck"><p class="font-sofia-light font-sm font-green text">No Odor Medicar</p></div>
                    </div>
                  </li>
                  <li>
                    <div class="row rowcheck">
                      <div class="col-md-2 col-xs-2 padcheck">
                        <label class="content-check">
                          <input type="checkbox" >
                          <span class="checkmark"></span>
                        </label>
                      </div>
                      <div class="col-md-10 col-xs-9 textcheck"><p class="font-sofia-light font-sm font-green text">Everglo</p></div>
                    </div>
                  </li>
                  <li>
                    <div class="row rowcheck">
                      <div class="col-md-2 col-xs-2 padcheck">
                        <label class="content-check">
                          <input type="checkbox" >
                          <span class="checkmark"></span>
                        </label>
                      </div>
                      <div class="col-md-10 col-xs-9 textcheck"><p class="font-sofia-light font-sm font-green text">Supersilk Anti Noda</p></div>
                    </div>
                  </li>
                  <li>
                    <div class="row rowcheck">
                      <div class="col-md-2 col-xs-2 padcheck">
                        <label class="content-check">
                          <input type="checkbox" >
                          <span class="checkmark"></span>
                        </label>
                      </div>
                      <div class="col-md-10 col-xs-9 textcheck"><p class="font-sofia-light font-sm font-green text">Aquamatt</p></div>
                    </div>
                  </li>
                  <li>
                    <div class="row rowcheck">
                      <div class="col-md-2 col-xs-2 padcheck">
                        <label class="content-check">
                          <input type="checkbox" >
                          <span class="checkmark"></span>
                        </label>
                      </div>
                      <div class="col-md-10 col-xs-9 textcheck"><p class="font-sofia-light font-sm font-green text">HomeDeco Metallic</p></div>
                    </div>
                  </li>
                </ul>
                <ul class="fgroup">
                  <li class="title-group">
                    <div class="row rowcheck">
                      <div class="col-md-2 col-xs-2 padcheck">
                        <label class="content-check">
                          <input type="checkbox" >
                          <span class="checkmark"></span>
                        </label>
                      </div>
                      <div class="col-md-10 col-xs-9 textcheck"><h4 class="font-sofia-bold">Cat Tembok </h4></div>
                    </div>
                  </li>
                  <li>
                    <div class="row rowcheck">
                      <div class="col-md-2 col-xs-2 padcheck">
                        <label class="content-check">
                          <input type="checkbox" >
                          <span class="checkmark"></span>
                        </label>
                      </div>
                      <div class="col-md-10 col-xs-9 textcheck"><p class="font-sofia-light font-sm font-green text">Avitex Exterior</p></div>
                    </div>
                  </li>
                  <li>
                    <div class="row rowcheck">
                      <div class="col-md-2 col-xs-2 padcheck">
                        <label class="content-check">
                          <input type="checkbox" >
                          <span class="checkmark"></span>
                        </label>
                      </div>
                      <div class="col-md-10 col-xs-9 textcheck"><p class="font-sofia-light font-sm font-green text">Avitex Cat Tembok</p></div>
                    </div>
                  </li>
                  <li>
                    <div class="row rowcheck">
                      <div class="col-md-2 col-xs-2 padcheck">
                        <label class="content-check">
                          <input type="checkbox" >
                          <span class="checkmark"></span>
                        </label>
                      </div>
                      <div class="col-md-10 col-xs-9 textcheck"><p class="font-sofia-light font-sm font-green text">Avitex One Coat</p></div>
                    </div>
                  </li>
                  <li>
                    <div class="row rowcheck">
                      <div class="col-md-2 col-xs-2 padcheck">
                        <label class="content-check">
                          <input type="checkbox" >
                          <span class="checkmark"></span>
                        </label>
                      </div>
                      <div class="col-md-10 col-xs-9 textcheck"><p class="font-sofia-light font-sm font-green text">Avitex Dapur & Kamar Mandi</p></div>
                    </div>
                  </li>
                  <li>
                    <div class="row rowcheck">
                      <div class="col-md-2 col-xs-2 padcheck">
                        <label class="content-check">
                          <input type="checkbox" >
                          <span class="checkmark"></span>
                        </label>
                      </div>
                      <div class="col-md-10 col-xs-9 textcheck"><p class="font-sofia-light font-sm font-green text">Aries Gold</p></div>
                    </div>
                  </li>
                  <li>
                    <div class="row rowcheck">
                      <div class="col-md-2 col-xs-2 padcheck">
                        <label class="content-check">
                          <input type="checkbox" >
                          <span class="checkmark"></span>
                        </label>
                      </div>
                      <div class="col-md-10 col-xs-9 textcheck"><p class="font-sofia-light font-sm font-green text">Jasmine</p></div>
                    </div>
                  </li>
                </ul>
              </div>
              <div class="col-sm-6 col-xs-12">
                <ul class="fgroup">
                  <li class="title-group">
                    <div class="row rowcheck">
                      <div class="col-md-2 col-xs-2 padcheck">
                        <label class="content-check">
                          <input type="checkbox" >
                          <span class="checkmark"></span>
                        </label>
                      </div>
                      <div class="col-md-10 col-xs-9 textcheck"><h4 class="font-sofia-bold">Cat Kayu Besi</h4></div>
                    </div>
                  </li>
                  <li>
                    <div class="row rowcheck">
                      <div class="col-md-2 col-xs-2 padcheck">
                        <label class="content-check">
                          <input type="checkbox" >
                          <span class="checkmark"></span>
                        </label>
                      </div>
                      <div class="col-md-10 col-xs-9 textcheck"><p class="font-sofia-light font-sm font-green text">Platinum</p></div>
                    </div>
                  </li>
                  <li>
                    <div class="row rowcheck">
                      <div class="col-md-2 col-xs-2 padcheck">
                        <label class="content-check">
                          <input type="checkbox" >
                          <span class="checkmark"></span>
                        </label>
                      </div>
                      <div class="col-md-10 col-xs-9 textcheck"><p class="font-sofia-light font-sm font-green text">Avian</p></div>
                    </div>
                  </li>
                  <li>
                    <div class="row rowcheck">
                      <div class="col-md-2 col-xs-2 padcheck">
                        <label class="content-check">
                          <input type="checkbox" >
                          <span class="checkmark"></span>
                        </label>
                      </div>
                      <div class="col-md-10 col-xs-9 textcheck"><p class="font-sofia-light font-sm font-green text">Glovin</p></div>
                    </div>
                  </li>
                  <li>
                    <div class="row rowcheck">
                      <div class="col-md-2 col-xs-2 padcheck">
                        <label class="content-check">
                          <input type="checkbox" >
                          <span class="checkmark"></span>
                        </label>
                      </div>
                      <div class="col-md-10 col-xs-9 textcheck"><p class="font-sofia-light font-sm font-green text">Yoko</p></div>
                    </div>
                  </li>
          
                </ul>
                <ul class="fgroup">
                  <li class="title-group">
                    <div class="row rowcheck">
                      <div class="col-md-2 col-xs-2 padcheck">
                        <label class="content-check">
                          <input type="checkbox" >
                          <span class="checkmark"></span>
                        </label>
                      </div>
                      <div class="col-md-10 col-xs-9 textcheck"><h4 class="font-sofia-bold">No Drop Cat Pelapis Anti Bocor</h4></div>
                    </div>
                  </li>
                  <li class="title-group">
                    <div class="row rowcheck">
                      <div class="col-md-2 col-xs-2 padcheck">
                        <label class="content-check">
                          <input type="checkbox" >
                          <span class="checkmark"></span>
                        </label>
                      </div>
                      <div class="col-md-10 col-xs-9 textcheck"><h4 class="font-sofia-bold">Giant Mortar Semen Instan</h4></div>
                    </div>
                  </li>
                  <li class="title-group">
                    <div class="row rowcheck">
                      <div class="col-md-2 col-xs-2 padcheck">
                        <label class="content-check">
                          <input type="checkbox" >
                          <span class="checkmark"></span>
                        </label>
                      </div>
                      <div class="col-md-10 col-xs-9 textcheck"><h4 class="font-sofia-bold">Suzuka Cat Auto Refinish</h4></div>
                    </div>
                  </li>
                  
          
                </ul>
              </div>

            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="map-info left bg-light-green md">
      <div id="marker-detail" class="marker-detail"></div>
    </div>

    <div class="map-info mf2 bg-light-green">
      <a href="#" class="fa fa-remove" onclick="$('.map-info').fadeOut()"></a>
      <img src="/avian_new/images/cabang/tirtakencana.png" width="50%">
      <p class="font-sofia-light font-sm">Kami memastikan seluruh produk Avian Brands tersedia secara merata di seluruh pelosok Indonesia melalui jalur distribusi terintegrasi<br>PT Tirtakencana Tatawarna.</p>
    </div>
  </div>
<style type="text/css">  
  .popover{
    margin-left: 20px !important;
    overflow: hidden !important;
  }
  @media (min-width: 320px) and (max-width: 480px) {
    .popover{
      min-width: auto !important;
    }
  }
</style>
<script src="/js/front/markerclusterer.js"></script>
<script src='https://maps.googleapis.com/maps/api/js?key=AIzaSyAdfB-1tzijt8NQRVY6SLNft9_JwxWxu1s&libraries=geometry'
  type="text/javascript"></script>
<script type="text/javascript" src="/avian_new/js/store-location.js"></script>
<script>
    var marker;
    var markers = new Array();
    var zoom = 5.5;
    var style=[];
    var styledMap = new google.maps.StyledMapType(style,{name: "Styled Map"});
    var map = new google.maps.Map(document.getElementById('map'), {
        zoom: zoom,
        center: new google.maps.LatLng(-11.920871, 114.916439),
        mapTypeId: google.maps.MapTypeId.ROADMAP,
        zoomControlOptions: {
            position: google.maps.ControlPosition.LEFT_BOTTOM
        },
        mapTypeControlOptions: {
            mapTypeIds: [google.maps.MapTypeId.ROADMAP, 'map_style']
        },
        disableDefaultUI: true
    });

    map.mapTypes.set('map_style', styledMap);
    map.setMapTypeId('map_style');
    var infowindow = new google.maps.InfoWindow({
        maxWidth: 200
    });
    // displayLocation(window['indonesia']);
    $(".location").change(function(e) {
        var place = $(this).val().toLowerCase().replace(/ /g, '');
        displayLocation(window[place]);
        e.preventDefault()
    });

    $("#x-close").click(function() {
       $('#cardMap').hide();
    });

    $(document).ready(function() {

        $.ajax({
            url: '<?= base_url() ?>new_shop/Store/read_store/',
            method: 'POST',
            dataType: 'json',
            data : {
                filter_places:'0',
            },
            success:function (resp){
                displayLocation(resp.result);
            }
        });

    });

    function do_search(){

        var filter_places = $("#select_place").val();

        $.ajax({
            url: '<?= base_url() ?>new_shop/Store/read_store/',
            method: 'POST',
            dataType: 'json',
            data : {
                filter_places:filter_places,
            },
            success:function (resp){
                if (resp.status == 200) {
                    // map.setZoom(12);
                    displayLocation(resp.result);

                } else {
                    alert('Tidak ada CSR yang terkait dengan filter');
                }
                // console.log(resp.result)
            }
        });
    }

    function clearMarkers() {
        if (isInfoWindowOpen(infowindow)) {
            infowindow.close()
        }
        for (var i = 0; i < markers.length; i++) {
            markers[i].setMap(null)
        }
    }

    function resetMarkers() {
        if (isInfoWindowOpen(infowindow)) {
            infowindow.close()
        }
        for (var i = 0; i < markers.length; i++) {
            markers[i].setIcon(markers[i].icon)
            // markers[i].setIcon('/avian_new/images/icon/marker.png')
        }
    }

    function displayLocation(locations) {
        clearMarkers();
        resetZoom();
        markers.length = 0;
        var icon_url ;
        for (var i = 0; i < locations.length; i++) {

            var icon_url = "/avian_new/images/icon/marker.png";
          
            marker = new google.maps.Marker({
                position: new google.maps.LatLng(locations[i]['latitude'], locations[i]['longitude']),
                map: map,
                icon: icon_url,
            });

            markers.push(marker);

            // console.log(markers)
            google.maps.event.addListener(map, 'click', (function(marker, i) {
                return function() {
                    infowindow.close();
                    AutoCenter()
                }
            })(marker, i));
            google.maps.event.addListener(marker, 'click', (function(marker, i) {
                return function() {
                    if (isInfoWindowOpen(infowindow)) {
                        // resetMarkers();
                        infowindow.close();
                        AutoCenter()
                    } else {
                        map.setZoom(12);
                        map.setCenter(marker.getPosition());
                        // var code = locations[i][2]== ""?"":locations[i][2]+"-",
                        //     phonetext = locations[i][3]==""?"":"<a href='tel:"+code+locations[i][3]+"'><i class='fa fa-phone'></i> "+code+locations[i][4]+"</a>";
                        // infowindow.setContent('<b>'+locations[i][0]+'</b><br>'+'<i class="fa fa-map-marker"></i> '+locations[i][1]+'<br>'+'<i class="fa fa-building"></i> '+locations[i][2]+'<br>'+'<i class="fa fa-phone"></i> '+locations[i][3]+'<br>'+'<i class="fa fa-envelope"></i> '+locations[i][4]);
                        // marker.setIcon(icon_url);
                       $("#marker-detail").html('<a href="#" class="fa fa-remove" onclick="hide_this()" style="float: right;"></a>'+'<b>'+locations[i]['nama_customer']+'</b><br>'+'<i class="fa fa-map-marker"></i><span>'+locations[i]['alamat']+'</span><br>'+'<i class="fa fa-phone"></i>'+locations[i]['telepon']+'<br><button type="button" onclick="to_the_maps('+locations[i]['latitude']+','+ locations[i]['longitude']+')" class="button button-rounded button-block btn-inline-green font-green">Navigasi ke Toko</button>');
                        $('.map-info.md').show();
                        // $("#url_csr").html(locations[i]['pretty_url']);
                        // infowindow.open(map, marker)
                    }
                }
            })(marker, i));
            google.maps.event.addListener(infowindow, 'closeclick', (function(marker, i) {
                return function() {
                    AutoCenter();
                }
            })(marker, i))
        }
        AutoCenter();

        var clusterOptions = {
          imagePath: "/avian_new/newcluster/m",
          gridSize: 30,
          zoomOnClick: 'true',
          maxZoom: 10,
        };

        const markerClusterer = new MarkerClusterer(map, markers, clusterOptions);

        const styles = markerClusterer.getStyles();
        styles.textColor = "black";
        styles.textSize = 20;
        // for (let i=0; i<styles.length; i++) {
        // }
    }

    function to_the_maps(lat,lng){

      window.open('https://www.google.com/maps/dir/Current+Location/'+lat+','+lng);
    }

    function resetZoom() {
        var boundsListener = google.maps.event.addListener((map), 'bounds_changed', function(event) {
            this.setZoom(5.5);
            google.maps.event.removeListener(boundsListener)
        })
    }

    function isInfoWindowOpen(infoWindow) {
        var map = infoWindow.getMap();
        return (map !== null && typeof map !== "undefined")
    }

    function AutoCenter() {
        var bounds = new google.maps.LatLngBounds();
        $.each(markers, function(index, marker) {
            bounds.extend(marker.position)
        });
        map.fitBounds(bounds)
    }
    AutoCenter()

    function hide_this(){
      $('#marker-detail').fadeOut();
    }
  </script>
  <script type="text/javascript" src="/avian_new/js/jquery.mousewheel.min.js"></script>
<script type="text/javascript" src="/avian_new/js/jquery.matchHeight-min.js"></script>